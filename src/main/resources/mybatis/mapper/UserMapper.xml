<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jones.panorama.mapper.UserMapper" >
    <resultMap id="userMap" type="User">
        <id property="userId" column="user_id" />
        <result property="username" column="username" />
        <result property="password" column="password" />
        <association property="role" resultMap="roleMap"/>
    </resultMap>
    <resultMap id="roleMap" type="Role">
        <id property="roleId" column="role_id" />
        <result property="roleName" column="role_name" />
        <result property="roleTitle" column="role_title" />
        <result property="projectCode" column="project_code" />
    </resultMap>

    <select id="findAll" resultMap="userMap">
        select u.*, r.* from user u left join user_role ur on u.user_id=ur.user_id
            left join role r on ur.role_id=r.role_id
    </select>

    <select id="findList" resultMap="userMap" parameterType="Query">
        <include refid="com.jones.panorama.mapper.CommonMapper.startPage" />
        select u.*, r.* from user u left join user_role ur on u.user_id=ur.user_id
            left join role r on ur.role_id=r.role_id
        where 1=1
        <if test="query != null and query.username != null and query.username !=''">
            and u.username = #{query.username}
        </if>
        <include refid="com.jones.panorama.mapper.CommonMapper.endPage" />
    </select>
    <select id="findCount" resultType="java.lang.Integer" parameterType="Query">
        select count(1) from user u
        where 1=1
        <if test="query != null and query.username != null and query.username !=''">
            and u.username = #{query.username}
        </if>
    </select>
    <select id="findOne" resultMap="userMap" parameterType="User">
        select u.*, r.* from user u left join user_role ur on u.user_id=ur.user_id
        left join role r on ur.role_id=r.role_id
        where username = #{username} and password = #{password}
    </select>

    <insert id="insert" parameterType="User">
        insert into user(username,password)
        values(#{username}, #{password})
    </insert>

    <update id="update" parameterType="User">
        update user set password=#{password} where username=#{username}
    </update>
</mapper>