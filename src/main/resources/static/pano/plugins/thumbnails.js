var krpanoplugin=function(){function s(){1==arguments.length&&g.trace(3,"thumbnails plugin "+v+": "+arguments[0])}function H(){g.trace(1,"\n****\nthumbnails plugin "+v+" functions list:\nbuild(thumbs_name,array_name,*group_name) - automaticaly build thumbnails\nremovethumbs(thumbs_name) - remove all thumbs\nsetframestyle(thumbs_name,thumb_name/index,framestyle_name,visited[true/false],active[true/false]) - set thumb frame style\nsetthumbstyle(thumbs_name,thumb_name/index,thumbstyle_name) - set thumb style\ndropactive(thumbs_name) - set current active thumb as inactive\nsetactive(thumbs_name,thumb_name/index) - set thumb as active\nsetvisited(thumbs_name,thumb_name/index,visited[true/false]) - set thumb as visited/not visited\n****")}function m(a,b){var d=g.get("plugin["+b+"]");d||s(a+" - plugin "+b+" not found!");return d?d:null}function q(a,b,d){for(var f=0;f<b.length;f++)if(!d&&(null==b[f]||"null"==b[f]||"NaN"==b[f]))return s(a+" - parametr "+f+" has null value!"),0;return f}function w(a,b,d,f){var c=m("updatepos",a);if(c&&(a=m("setactive",a+"_bar"))){var n,h=0,i,l="1.2",e="easeOutQuad";i=Number(a.vertical?a.y:a.x)+20*b;b=c.vertical?"y":"x";n=c.vertical?Number(c.pixelheight)-Number(a.height):Number(c.pixelwidth)-Number(a.width);0<n&&(n=0);l=a.align.toLowerCase();if(c.vertical&&("left"==l||"center"==l||"right"==l)||!c.vertical&&("top"==l||"center"==l||"bottom"==l))n/=2,h=Math.abs(n);i>h?(n=h,c=" GT "):c=" LT ";"begin"==d||"end"==d?(l="distance("+f+",1.2)",e="linear",a.tweendirection=d):(l="1.2",e="easeOutQuad");"end"==d&&(i=n);"begin"==d&&(i=h);g.call("tween(plugin["+a.name+"]."+b+","+i+","+l+","+e+",,"+("if(plugin["+a.name+"]."+b+c+n+", delayedcall(0.04, "+("tween(plugin["+a.name+"]."+b+","+n+",0.4,easeOutQuad,,)")+"););")+");")}}function B(){var a=j.vertical?g.mouse.y:g.mouse.x;p=a-x;x=a}function I(a){if(!y&&(j=m("startmousemove",a)))g.call("stoptween(plugin["+a+"]."+(j.vertical?"y":"x")+")"),t=x=j.vertical?g.mouse.y:g.mouse.x,window.addEventListener(g._isrealdesktop?"mouseup":"touchend",z,!0),window.addEventListener(g._isrealdesktop?"mousemove":"touchmove",A,!0),p=0,B(),C=setInterval(B,20),y=!0}function z(){window.removeEventListener(g._isrealdesktop?"mouseup":"touchend",z,!0);window.removeEventListener(g._isrealdesktop?"mousemove":"touchmove",A,!0);clearInterval(C);y=!1;j&&(j.vertical?-1<j.align.toLowerCase().indexOf("bottom")&&(p=0-p):-1<j.align.toLowerCase().indexOf("right")&&(p=0-p),21<p&&(p=21),-21>p&&(p=-21),w(j.parent,p))}function A(){if(j){var a=Number(j.vertical?j.y:j.x),b=j.vertical?g.mouse.y:g.mouse.x;j.vertical?(a=-1<j.align.toLowerCase().indexOf("bottom")?a+(t-b):a+(b-t),j.y=a):(a=-1<j.align.toLowerCase().indexOf("right")?a+(t-b):a+(b-t),j.x=a);t=b}}function J(){var a=m("setactive",arguments[0]);a&&(2==q("setvisited",arguments)&&a.thumbsready)&&(a=Number(a.vertical?a.pixelheight:a.pixelwidth),500<a&&(a=500),w(arguments[0],0,arguments[1],a))}function K(){var a=0,b=m("stopmove",arguments[0]+"_bar");b&&1==q("stopmove",arguments)&&("begin"==b.tweendirection&&(a=1),"end"==b.tweendirection&&(a=-1),w(arguments[0],a))}function D(){var a=m("setvisited",arguments[0]);if(a&&(3==q("setvisited",arguments)&&a.thumbsready)&&a&&(a=a.thumb?a.thumb.getItem(arguments[1]):null))if(a=m("setvisited",arguments[0]+"_"+a.name))a.thumbvisited=arguments[2],u(arguments[0],arguments[1],a.framestyle,arguments[2],a.thumbactive,"silent")}function L(){var a=m("setactive",arguments[0]);if(a&&1<q("setactive",arguments,arguments[2])){var b=a.thumb?a.thumb.getItem(arguments[1]):null;if(b){var d=m("setactive",arguments[0]+"_"+b.name);if(d&&(E(arguments[0]),a.activethumb=arguments[1],d.thumbactive=!0,a.visitedauto?D(arguments[0],arguments[1],!0):u(arguments[0],arguments[1],d.framestyle,d.thumbvisited,!0,"silent"),"false"!=a.autoactivejump&&(b=m("setactive",arguments[0]+"_bar")))){var f=Boolean(a.vertical),c=f?"y":"x",n=Number(f?a.pixelheight:a.pixelwidth),h=Number(f?b.y:b.x),i=Number(f?b.height:b.width),l=Number(f?d.height:d.width),d=Number(f?d.y:d.x)-l/2,e=0,j=0,k=!1,e=a.thumbsalign.toLowerCase();if(f&&-1<e.indexOf("bottom")||!f&&-1<e.indexOf("right")){e=d+n-i;j=d+l+2*Number(a.thumbindent)-i;if(h>e||h<j)k=!0;h<j&&(e=j)}else{f&&("left"==e||"center"==e||"right"==e)||!f&&("top"==e||"center"==e||"bottom"==e)?(e=i/2-n/2-d,j=i/2-n/2-d+n-l-2*Number(a.thumbindent)):(e=0-d,j=0-d+n-l-2*Number(a.thumbindent));if(h<e||h>j)k=!0;h>j&&(e=j)}k&&(g.call("stoptween(plugin["+b.name+"]."+(f?"y":"x")+")"),g.call("delayedcall(0.1,tween(plugin["+b.name+"]."+c+","+e+",distance(300,0.8),easeOutQuad););"))}}}}function E(){var a=m("dropactive",arguments[0]);if(a&&0<q("dropactive",arguments,arguments[1])){var b=a.thumb?a.thumb.getItem(a.activethumb):null;b&&(b=m("dropactive",arguments[0]+"_"+b.name))&&u(arguments[0],a.activethumb?a.activethumb:0,b.framestyle?b.framestyle:"default",b.thumbvisited,!1,"silent")}}function F(){var a=m("setthumbstyle",arguments[0]);if(a&&3<q("setthumbstyle",arguments)){var b=a.thumb?a.thumb.getItem(arguments[1]):null;if(b){var d=arguments[2]?arguments[2]:"default",b=m("setthumbstyle",arguments[0]+"_"+b.name),a=a.thumbstyle?a.thumbstyle.getItem(d):null;if(b&&a){b.thumbstyle=d;for(var d=a.getattributes(),f=0;f<d.length;f++)"name"!=d[f]&&(b[d[f]]=a[d[f]]);u(arguments[0],arguments[1],a.framestyle?a.framestyle:"default",b.thumbvisited,b.thumbactive,"silent")}"silent"!=arguments[3]&&!a&&s("setthumbstyle - thumbstyle "+arguments[2]+" not found!")}}}function u(){var a=m("setframestyle",arguments[0]);if(a&&4<q("setframestyle",arguments,!0)){var b=a.thumb?a.thumb.getItem(arguments[1]):null;if(b){var d=arguments[2]?arguments[2]:"default",f=m("setframestyle",arguments[0]+"_"+b.name),b=m("setframestyle",arguments[0]+"_"+b.name+"_frame"),a=a.framestyle?a.framestyle.getItem(d):null;if(f&&b){f.framestyle=d;if(a)for(var d=a.getattributes(),c=0;c<d.length;c++)"name"!=d[c]&&(b[d[c]]=a[d[c]]);"silent"!=arguments[5]&&s("setframestyle - framestyle "+arguments[2]+" not found!");b.url=a&&a.url?a.url:"plugins/thumbnailsframe.png";var d=a&&a.cropleft?a.cropleft:0,c=a&&a.croptop?a.croptop:0,g=a&&a.cropwidth?a.cropwidth:109,a=a&&a.cropheight?a.cropheight:86,h=arguments[3];"false"==h&&(h=!1);(f.thumbvisited=h)&&(d+=g);h=arguments[4];"false"==h&&(h=!1);(f.thumbactive=h)&&(c+=3*a);b.crop=d+"|"+c+"|"+g+"|"+a;b.onovercrop=d+"|"+a+"|"+g+"|"+a;b.ondowncrop=d+"|"+2*a+"|"+g+"|"+a}}}}function G(){var a=m("removethumbs",arguments[0]);if(a&&0<q("removethumbs",arguments)&&a.thumb){for(var b=0;b<a.thumb.count;b++)g.call("removeplugin("+a.name+"_"+a.thumb.getItem(b).name+"_frame);"),g.call("removeplugin("+a.name+"_"+a.thumb.getItem(b).name+");");a.removearray("thumb");a.thumb_prev&&a.removearray("thumb_prev");a.thumbsready=!1}}function M(){var a=arguments[0],b=m("build",a);if(b&&0<q("build",arguments)){b.thumbsready=!1;if(arguments[1]){var d=0;b.thumb&&b.removearray("thumb");b.createarray("thumb");var f=g.get(arguments[1].toLowerCase());if(f)for(var c=0;c<f.count;c++){if(arguments[2]==f.getItem(c).group){b.thumb.createItem(f.getItem(c).name);if("scene"==arguments[1].toLowerCase())for(var i in f.getItem(c))"name"!=i&&("index"!=i&&"onstart"!=i&&"content"!=i)&&(b.thumb.getItem(d)[i]=f.getItem(c)[i]);else for(var h=f.getItem(c).getattributes(),j=0;j<h.length;j++)b.thumb.getItem(d)[h[j]]=f.getItem(c)[h[j]];d++}}else s(" array "+arguments[1]+" not found!")}if(b.thumb_prev){d=!1;for(c=0;c<b.thumb_prev.count;c++)if(d=b.thumb?c<b.thumb.count?b.thumb.getItem(c).name!=b.thumb_prev.getItem(c).name?!0:!1:!0:!0)g.call("removeplugin("+b.name+"_"+b.thumb_prev.getItem(c).name+"_frame);"),g.call("removeplugin("+b.name+"_"+b.thumb_prev.getItem(c).name+");");b.removearray("thumb_prev")}if(b.thumb){b.createarray("thumb_prev");for(c=0;c<b.thumb.count;c++)b.thumb_prev.createItem(b.thumb.getItem(c).name);-1==r.indexOf(a)&&r.push(a);b.maskchildren=!0;b.scalechildren=!0;b.activethumb=0;d=b.vertical&&"false"!=b.vertical?!0:!1;b.vertical=d;b.thumbsalign||(b.thumbsalign=d?"top":"left");b.visitedauto=!1==b.visitedauto||"false"==b.visitedauto?!1:!0;b.activeauto=!1==b.activeauto||"false"==b.activeauto?!1:!0;f=a+"_bar";g.plugin.getItem(f)||(g.call("addplugin("+f+")"),g.call("set(plugin["+f+"].parent,"+a+")"),g.plugin.createItem(f));c=m("build",f);g.call("stoptween(plugin["+f+"]."+(d?"y":"x")+")");c.keep=b.keep;c.align=b.thumbsalign;c.oldx=0;c.x=0;c.y=0;c.type="container";c.bgcolor="0x000000";c.bgalpha="0";c.bgcapture=!0;c.ondown=N;c.vertical=d;c.width="100%";c.height="100%";if(b.thumb){f=b.thumbwidth?Number(b.thumbwidth):93;i=b.thumbheight?Number(b.thumbheight):70;var l=b.thumbindent?Number(b.thumbindent):10,h=b.thumb.count*(d?i+l:f+l)+l;c.vertical?c.height=h:c.width=h;for(c=0;c<b.thumb.count;c++){var e=b.thumb.getItem(c);b.thumbindent=l;e.thumbstyle||(e.thumbstyle="default");e.framestyle||(e.framestyle="default");e.thumbonclick&&(e.onclick=e.thumbonclick);e.thumbonhover&&(e.onclick=e.thumbonhover);e.thumbonover&&(e.onclick=e.thumbonover);e.thumbonout&&(e.onclick=e.thumbonout);e.thumbondown&&(e.onclick=e.thumbondown);e.thumbonup&&(e.onclick=e.thumbonup);var p=a+"_"+e.name;g.call("addplugin("+p+")");for(var k=g.plugin.createItem(p),h=e.getattributes(),j=0;j<h.length;j++)"name"!=h[j]&&(k[h[j]]=e[h[j]]);k.parent=a+"_bar";k.keep=b.keep;k.capture=!1;k.align=d?"top":"left";k.edge="center";k.x=d?0:c*(f+l)+f/2;k.y=d?c*(i+l)+i/2:0;k.ox=d?0:l;k.oy=d?l:0;k.width=f;k.height=i;k.stagename=a;k.thumbindex=c;k.thumbactive=!1;k.thumbvisited=!1;e.url||e.thumburl?k.url=e.thumburl?e.thumburl:e.url:(k.type="container",k.bgcolor="0x000000",k.bgalpha="0.2");h=p+"_frame";g.call("addplugin("+h+")");h=g.plugin.createItem(h);h.parent=p;h.keep=b.keep;h.capture=!1;h.align="center";h.x=0;h.y=0;h.ox=0;h.oy=0;h.onloaded="resetsize()";F(a,c,e.thumbstyle,"silent");u(a,c,e.framestyle,!1,!1,"silent");h=b.activeauto?O:b.visitedauto?P:"";h+=k.onclick?k.onclick:"";k.onclick=h}}b.thumbsready=!0;b.onthumbsready&&g.call("delayedcall(0.05,"+b.onthumbsready+")")}else s(" plugin "+arguments[0]+" has no thumbs!")}}var g=null,i=null,v="v1.0",t=0,x=0,p=0,y=!1,r=[],C,P="thumbnails.setvisited(get(stagename),get(thumbindex),true);",O="thumbnails.setactive(get(stagename),get(thumbindex));",N="thumbnails.startmousemove(get(name));",j;this.registerplugin=function(a,b,d){g=a;i=d;i.keep=!0;i.enabled=!1;i.width="100%";i.height="100%";i.registerattribute("onready","");i.registerattribute("onresized","");i.build=M;i.setframestyle=u;i.setthumbstyle=F;i.setvisited=D;i.setactive=L;i.dropactive=E;i.removethumbs=G;i.help=H;i.startmousemove=I;i.stopmove=K;i.moveto=J;g.thumbnails=i;g.trace(1,"thumbnails plugin "+v+" - loaded and ready.");g.call(i.onready)};this.unloadplugin=function(){i=null;for(var a=0;a<r.length;a++)G(r[a]),g.removeplugin(r[a]+"_bar");window.removeEventListener(g._isrealdesktop?"mouseup":"touchend",z,!0);window.removeEventListener(g._isrealdesktop?"mousemove":"touchmove",A,!0);g.trace(1,"thumbnails plugin "+v+" - successfully unloaded.");g=null};this.onresize=function(){for(var a=0;a<r.length;a++)setTimeout(w,0,r[a],0),g.call(i.onresized),g.call(g.get("plugin["+r[a]+"].onresized"))}};